var groups = [
 {
   "name": "Paul Di Giordano & Nate Wolde",
   "location": "Midtown Sacramento ",
   "dayofweek": "Tuesday ",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/199/responses/new",
   "gender": "male"
 },
 {
   "name": "Cody Williams & Jonathan Sweetser",
   "location": "El Dorado Hills",
   "dayofweek": "Monday",
   "time": "6:30 AM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/223/responses/new",
   "gender": "male"
 },
 {
   "name": "Brandon Waring & Rayshaun Smith",
   "location": "Folsom ",
   "dayofweek": "Tuesday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/224/responses/new",
   "gender": "male"
 },
 {
   "name": "Andrew Davis",
   "location": "Folsom",
   "dayofweek": "Wednesday ",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/237/responses/new",
   "gender": "male"
 },
 {
   "name": "Erik Bagley",
   "location": "Hwy 50 Tahoe Park",
   "dayofweek": "Thursday",
   "time": "7:00 AM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/238/responses/new",
   "gender": "male"
 },
 {
   "name": "Adrian Weller",
   "location": "Folsom ",
   "dayofweek": "Tuesday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/225/responses/new",
   "gender": "male"
 },
 {
   "name": "Chris Breyer",
   "location": "Cameron Park",
   "dayofweek": "Wednesday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/226/responses/new",
   "gender": "male"
 },
 {
   "name": "Gabriel Fitzgerald",
   "location": "Loomis",
   "dayofweek": "Tuesday",
   "time": "6:30 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/227/responses/new",
   "gender": "male"
 },
 {
   "name": "Steve Woodcock",
   "location": "Placerville",
   "dayofweek": "Saturday",
   "time": "8:00 AM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/228/responses/new",
   "gender": "male"
 },
 {
   "name": "Augustin Murar",
   "location": "Orangevale",
   "dayofweek": "Thursday ",
   "time": "6:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/229/responses/new",
   "gender": "male"
 },
 {
   "name": "Michael Miller",
   "location": "El Dorado Hills ",
   "dayofweek": "Wednesday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/230/responses/new",
   "gender": "male"
 },
 {
   "name": "Josh Minor & Fred Butson & Lucas Robinson",
   "location": "El Dorado Hills ",
   "dayofweek": "Monday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/231/responses/new",
   "gender": "male"
 },
 {
   "name": "Jeff Kreiser",
   "location": "Folsom",
   "dayofweek": "Monday",
   "time": "7:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/232/responses/new",
   "gender": "male"
 },
 {
   "name": "Bruce Kynaston & Joaquin Beza",
   "location": "Elk Grove",
   "dayofweek": "Wednesday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/233/responses/new",
   "gender": "male"
 },
 {
   "name": "Ben Serpell & Abe Haynes",
   "location": "El Dorado Hills",
   "dayofweek": "Mondays ",
   "time": "7:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/234/responses/new",
   "gender": "male"
 },
 {
   "name": "Harvey Smith",
   "location": "Lincoln ",
   "dayofweek": "Monday",
   "time": "7:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/235/responses/new",
   "gender": "male"
 },
 {
   "name": "Alan Garrett",
   "location": "Citrus Heights",
   "dayofweek": "Thursday",
   "time": "7:00 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/236/responses/new",
   "gender": "male"
 },
 {
   "name": "Chris Head",
   "location": "Carmichael",
   "dayofweek": "Wednesday",
   "time": "8:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/240/responses/new",
   "gender": "male"
 },
 {
   "name": "Nathan Grensavitch",
   "location": "Roseville",
   "dayofweek": "Monday",
   "time": "7:00 PM",
   "kids": "Yes",
   "signuplink": "",
   "gender": "male"
 },
 {
   "name": "Jessica Gilstrap",
   "location": "Folsom",
   "dayofweek": "Wednesday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/200/responses/new",
   "gender": "female"
 },
 {
   "name": "Jessica Volpendesta and Kristina Owen",
   "location": "Sacramento",
   "dayofweek": "Wednesday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/201/responses/new",
   "gender": "female"
 },
 {
   "name": "Heather Kreiser and Kim Kemper",
   "location": "Folsom",
   "dayofweek": "Tuesday",
   "time": "7:00 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/202/responses/new",
   "gender": "female"
 },
 {
   "name": "Brenda Miller and Juanita Miller",
   "location": "El Dorado Hills",
   "dayofweek": "Wednesday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/203/responses/new",
   "gender": "female"
 },
 {
   "name": "Geta Murar",
   "location": "Orangevale",
   "dayofweek": "Thursday",
   "time": "6:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/204/responses/new",
   "gender": "female"
 },
 {
   "name": "Andrea Smith",
   "location": "Lincoln",
   "dayofweek": "Wednesday",
   "time": "6:30 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/205/responses/new",
   "gender": "female"
 },
 {
   "name": "Susan Woodcock and Sharon Monasmith",
   "location": "Cameron Park",
   "dayofweek": "Tuesday",
   "time": "6:30 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/206/responses/new",
   "gender": "female"
 },
 {
   "name": "Lynne Randolph",
   "location": "El Dorado Hills",
   "dayofweek": "Wednesday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/207/responses/new",
   "gender": "female"
 },
 {
   "name": "Judy Trent-Whitnack",
   "location": "Orangevale",
   "dayofweek": "Friday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/208/responses/new",
   "gender": "female"
 },
 {
   "name": "Irina Melnik",
   "location": "Rancho Murieta",
   "dayofweek": "Wednesday",
   "time": "7:00 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/209/responses/new",
   "gender": "female"
 },
 {
   "name": "Lyndsee Sisemore and Stephanie Young",
   "location": "Fair Oaks",
   "dayofweek": "Thursday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/210/responses/new",
   "gender": "female"
 },
 {
   "name": "Rachel Taylor and Payton Carty ",
   "location": "Rancho Cordova",
   "dayofweek": "Monday",
   "time": "6:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/211/responses/new",
   "gender": "female"
 },
 {
   "name": "Tiina Fitzgerald and Sheri Struthers",
   "location": "El Dorado Hills",
   "dayofweek": "Tuesday",
   "time": "10:00 AM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/212/responses/new",
   "gender": "female"
 },
 {
   "name": "Sandy Perez",
   "location": "Elk Grove ",
   "dayofweek": "Tuesday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/213/responses/new",
   "gender": "female"
 },
 {
   "name": "Sonja Weller",
   "location": "Fair Oaks",
   "dayofweek": "Tuesday",
   "time": "6:30 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/214/responses/new",
   "gender": "female"
 },
 {
   "name": "Pam Jackson (Starting a week late)",
   "location": "Rocklin",
   "dayofweek": "Tuesday",
   "time": "10:00 AM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/215/responses/new",
   "gender": "female"
 },
 {
   "name": "Kelly Kynaston and Sandy Perez",
   "location": "Elk Grove",
   "dayofweek": "Wednesday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/216/responses/new",
   "gender": "female"
 },
 {
   "name": "Andrea Butson & Trish Minor",
   "location": "Cameron Park",
   "dayofweek": "Monday",
   "time": "7:00 PM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/217/responses/new",
   "gender": "female"
 },
 {
   "name": "LeeAnn Danielson",
   "location": "Sacramento ",
   "dayofweek": "Thursday",
   "time": "10:30 AM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/218/responses/new",
   "gender": "female"
 },
 {
   "name": "Christy Well",
   "location": "Roseville",
   "dayofweek": "Thursday",
   "time": "7:00 AM",
   "kids": "No",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/219/responses/new",
   "gender": "female"
 },
 {
   "name": "Francine Hardy",
   "location": "Rancho Cordova",
   "dayofweek": "Friday",
   "time": "6:00 AM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/220/responses/new",
   "gender": "female"
 },
 {
   "name": "Marialice Garrett",
   "location": "Citrus Heights",
   "dayofweek": "Thursday",
   "time": "7:00 PM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/222/responses/new",
   "gender": "female"
 },
 {
   "name": "Ava Elkow",
   "location": "Cool",
   "dayofweek": "Tueday",
   "time": "6:30 PM",
   "kids": "No ",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/241/responses/new",
   "gender": "female"
 },
 {
   "name": "Amanda Head",
   "location": "Carmichael ",
   "dayofweek": "Wednesday",
   "time": "9:30 AM",
   "kids": "Yes",
   "signuplink": "https://jcsacramento.ccbchurch.com/goto/forms/242/responses/new",
   "gender": "female"
 }
];

var days = [
  'Sunday',
  'Monday',
  'Tuesday',
  'Wednesday',
  'Thursday',
  'Friday',
  'Saturday'
]

$(document).ready(function() {

    var localStorage = window.localStorage;

    function uniqueArray(value, index, self) {
      return self.indexOf(value) === index
    }

    function formatCityString(str) {
      return str.replace(/\s+/g, '-').toLowerCase();
    }

    function addDayFilterListeners() {
      days.forEach(function(day) {
        $(`#day-${day}-filter`).click("click", function() {
          dayFilter(day);
        });
      });
    }

    days.forEach(function(day) {
      $('#day-filter').append(`<a class="dropdown-item" id="day-${day}-filter">${day}</a>`);
    });

    addDayFilterListeners();

    function filteredGenders() {
      var found = []
      groups.map(function(group) {
        if(group.gender === localStorage.gender) {
          found.push(group);
        }
      })
      return found;
    }

    function createFilteredCitys() {
      var filterGenersArray = filteredGenders(groups)
      var citys = filterGenersArray.map(function(group) {
        return group.location
      }).filter(uniqueArray);

      citys.forEach(function(city) {
        var formattedCity = formatCityString(city);
        $('#city-filter').append(`<a class="dropdown-item" id="${formattedCity}-filter">${city}</a>`)
      });
      addCityFilters(citys)
    }

    function addCityFilters(citys) {
      citys.forEach(function(city) {
        var formattedCity = formatCityString(city);
        $(`#${formattedCity}-filter`).click("click", function() {
          cityFilter(formattedCity);
        });
      });
    }

    var options = {
      valueNames: [
        "name",
        "location",
        "dayofweek",
        "time",
        "kids",
        { name: "signuplink", attr: "href" }
      ]
    };

    var groupsList = new List('groups-list', options, groups)

    function dayFilter(day) {
      groupsList.filter(function(group) {
        var values = group.values();
        if(values.dayofweek === day & values.gender === localStorage.gender) {
          return true;
        } else {
          return false;
        }
      })
    }

    function cityFilter(city) {
      groupsList.filter(function(group) {
        var values = group.values();
        if(formatCityString(values.location) === city && values.gender === localStorage.gender) {
          return true;
        } else {
          return false;
        }
      });
    }

    function genderFilter() {
      groupsList.filter(function(group) {
        if(group.values().gender === localStorage.gender) {
          return true;
        } else {
          return false;
        }
      })
    }

    function childcareFilter(val) {
      groupsList.filter(function(group) {
        var values = group.values();
        if(values.kids === val & values.gender === localStorage.gender) {
          return true;
        } else {
          return false;
        }
      })
    }

    function clearFilters() {
      groupsList.filter();
    }
    $('#clear-filters').click("click", clearFilters);

    $('#no-childcare').click("click", function() {
      childcareFilter('No');
    });
    $('#yes-childcare').click("click", function() {
      childcareFilter('Yes');
    });

    // Google Map

    // Initializes map and defaults to the men groups url
    $('<iframe src="https://www.google.com/maps/d/u/0/embed?mid=1LAWWyZCiU7v8otNHZt_U6Us6RC7ApkWJ" width="640" height="480"></iframe>')
     .appendTo('#map');

    // Addes click listeners to the buttons when choosing men or womens small group
    $('#women-selector').click("click", womenSelector);
    $('#men-selector').click("click", menSelector);

    // Removes the iframe when changing groups
    function emptyMap() {
      $('#map').empty();
    }

    function emptyCityFilters() {
      $('#city-filter').empty();
    }

    function womenSelector() {
      localStorage.setItem('gender', 'female');
      emptyCityFilters()
      createFilteredCitys();
      genderFilter();
      emptyMap();
      $('<iframe src=" https://www.google.com/maps/d/u/0/embed?mid=1sBsy1oCa4Hk-6XnS7bRpVju5qfcybEXI"></iframe>')
       .appendTo('#map');
    }

    function menSelector() {
      localStorage.setItem('gender', 'male');
      emptyCityFilters()
      createFilteredCitys();
      genderFilter();
      emptyMap();
      $('<iframe src=" https://www.google.com/maps/d/u/0/embed?mid=1LAWWyZCiU7v8otNHZt_U6Us6RC7ApkWJ"></iframe>')
       .appendTo('#map');
    }

    localStorage.setItem('gender', 'male');
    genderFilter();
    createFilteredCitys();
});
